# Chrome 144 Origin Trials - 中文摘要

## 领域摘要

Chrome 144 引入了两项重要的实验性试用功能,分别推进了 Web 平台能力的不同方面。增强的 Canvas API TextMetrics 功能为基于 canvas 的应用程序带来了复杂的文本操作能力,支持精确的文本编辑、选择处理以及字形级别的操作,这些在以前很难或无法实现。上下文感知媒体元素代表了 Web 应用程序请求媒体权限方式的根本性转变,用声明式的、用户激活的控件替代了 JavaScript 触发的提示,提供了更清晰的用户意图信号以及对先前拒绝权限的更好恢复路径。这两项功能共同扩展了 canvas 文本编辑生态系统并使媒体权限工作流程现代化,解决了长期存在的开发者痛点。

## 详细更新

Chrome 144 的实验性试用功能专注于通过改进 canvas 上下文中的文本操作和现代化的媒体访问权限模型来增强 Web 应用程序能力。

### Enhanced Canvas API `TextMetrics`

#### 新增内容

Canvas API `TextMetrics` 接口已得到显著扩展,支持选择矩形、边界框查询以及基于字形簇的操作。这一增强将 canvas 转变为更强大的平台,适用于复杂的文本编辑应用程序。

#### 技术细节

扩展的 `TextMetrics` API 为开发者提供了对文本渲染细节的精细访问,支持准确的选择处理、精确的光标定位和可靠的点击测试。基于簇的渲染能力在字形级别工作,允许对单个字符簇进行操作,而不仅仅是文本字符串。这种粒度控制对于在 canvas 上下文中实现复杂的文本编辑器和设计工具至关重要。

#### 适用场景

此功能使基于 canvas 的文本编辑应用程序能够达到与原生文本编辑器相匹配的能力。开发者可以实现:
- 具有准确视觉反馈的精确文本选择
- 尊重复杂脚本和连字的光标定位
- 用于确定用户点击了哪个字符的点击测试
- 高级文本效果,如独立的字符动画
- 用于创意应用程序的逐字符样式和操作

基于簇的操作对于需要复杂文本效果或处理复杂脚本(单个字形与字符不是一对一映射)的应用程序特别有价值。

#### 参考资料

- [实验性试用](https://developer.chrome.com/origintrials/#/view_trial/1646628613757337601)
- [跟踪错误 #341213359](https://issues.chromium.org/issues/341213359)
- [ChromeStatus.com 条目](https://chromestatus.com/feature/5075532483657728)
- [规范](https://github.com/whatwg/html/pull/11000)

### Context-aware media elements (上下文感知媒体元素)

#### 新增内容

上下文感知媒体元素引入了用于访问和交互媒体流的声明式、用户激活的控件。这代表了从 JavaScript 发起的权限提示向浏览器控制的 UI 元素的根本性转变,提供了更清晰的用户意图信号。

#### 技术细节

上下文感知媒体元素不是直接从 JavaScript 触发权限提示,而是在页面中嵌入一个浏览器控制的元素。当用户点击此元素时,它提供了明确的有意操作信号,从而实现更好的权限提示用户体验。这种方法是在开发者和浏览器供应商的反馈基础上从早期通用的 `<permission>` 元素演变而来的,产生了能力特定的元素,为开发者提供了更定制化和强大的体验。

#### 适用场景

此功能通过以下方式解决了长期存在的侵入性或令人困惑的权限提示问题:
- 提供符合用户期望的声明式媒体访问请求方式
- 为先前拒绝权限的用户提供更好的恢复路径
- 通过更清晰的用户意图信号减少权限请求流程中的摩擦
- 提供对权限提示何时以及如何出现的更细粒度控制

能力特定的设计允许针对特定用例优化每种元素类型,无论是访问摄像头、麦克风还是其他媒体能力。

#### 开发者迁移

参与早期 `<permission>` 元素实验性试用的开发者应注意,此功能代表了该概念的演进。转向能力特定的元素为不同的媒体类型提供了更好的人体工程学和更有针对性的功能。

#### 参考资料

- [实验性试用](https://developer.chrome.com/origintrials/#/view_trial/3736298840857247745)
- [跟踪错误 #443013457](https://issues.chromium.org/issues/443013457)
- [ChromeStatus.com 条目](https://chromestatus.com/feature/4926233538330624)
- [规范](https://wicg.github.io/PEPC/permission-elements.html)
